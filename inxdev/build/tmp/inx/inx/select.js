// @include inx.dropdown,inx.list

inx.select=inx.dropdown.extend({constructor:function(p){if(!p.width)p.width=300;p.resizeDropdown=true;p.dropdown={type:"inx.list",data:p.data,loader:p.loader,autoHeight:true,maxHeight:200,listeners:{click:[this.id(),"native_handleSelect"],load:[this.id(),"handleLoad"]},renderer:p.renderer};p.item={type:"inx.select.item"};p.side=[{type:"inx.toolbar_button",region:"right",icon:"trigger",onclick:[this.id(),"expand"],hideSeparator:true},{width:3,region:"right",hideSeparator:true,background:"none"}]
this.base(p);if(p.onchange)this.on("change",p.onchange);},cmd_render:function(c){this.base(c);this.el.css("cursor","pointer");this.cmd("createDropdown");this.suspendEvents();if(this.value!==undefined)this.cmd("setValue",this.value);this.unsuspendEvents();},cmd_setData:function(data){this.dropdown().cmd("setData",data);this.cmd("setText",this.idToValue(this.info("value")));},cmd_handleLoad:function(){var v=this.idToValue(this.value);this.cmd("setText",v);},cmd_native_handleSelect:function(id){this.cmd("setValue",id);this.cmd("collapse");this.task("focus");},cmd_setText:function(txt){this.item().cmd("setText",txt);},idToValue:function(id){var item=this.dropdown().info("item",id);if(item){var e=$("<div>");this.dropdown().cmd("renderNodeTo",id,e);return e;}else{return"&mdash;";}},info_value:function(){return this.value;},cmd_setValue:function(val){if(this.value!=val){this.value=val;this.fire("change",val);}
this.cmd("setText",this.idToValue(val));},cmd_expand:function(){this.dropdown().cmd("select",this.info("value"));this.base();this.dropdown().task("focus");},cmd_keydown:function(e){switch(e.keyCode){case 13:case 40:this.cmd("expand");return false;}
this.base(e);},cmd_mousedown:function(){this.cmd("expand");}});