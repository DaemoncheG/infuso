// @include inx.panel,inx.layout.fit

inx.dropdown=inx.panel.extend({constructor:function(p){if(!p.layout)p.layout="inx.layout.fit";if(p.keepBorder===undefined)p.keepBorder=true;if(!p.height)p.height=22;if(!p.labelAlign)p.labelAlign="left";p.border=0;p.padding=0;this.private_item=inx(p.item);p.items=[this.private_item];this.base(p);this.private_dropdownDescr=p.dropdown;},dropdown:function(){return this.private_dropdown||inx();},item:function(){return this.private_item||inx();},cmd_render:function(c){this.base(c);this.el.css("background","none");this.ext=$("<div />").css({display:"none",position:"absolute",padding:2,background:"#ededed",margin:-2,float:"left",zIndex:inx.conf.z_index_field}).appendTo("body");},cmd_syncLayout:function(r){this.base();if(this.resizeDropdown)
this.dropdown().cmd("width",this.info("width"));},cmd_handleSmoothBlur:function(){this.cmd("collapse");this.base();},cmd_createDropdown:function(){if(!this.private_dropdownCreated){this.private_dropdownCreated=true;this.private_dropdown=inx(this.private_dropdownDescr);this.dropdown().cmd("render",this.ext).setOwner(this);}},cmd_expand:function(){this.cmd("createDropdown");this.fire("expand");var cmpid=this.dropdown().id();this.ext.fadeIn("fast");this.dropdown().task("show").task("syncLayout");this.task("updateDropdownPosition");var cmpid=this.id();this.private_updateInterval=setInterval(function(){inx(cmpid).cmd("updateDropdownPosition");},300);},cmd_collapse:function(){clearInterval(this.private_updateInterval);if(!this.ext)return;var cmpid=this.dropdown().id();this.ext.fadeOut("fast",function(){inx(cmpid).cmd("hide");});this.dropdown().cmd("hide");},cmd_updateDropdownPosition:function(){var o=this.el.offset();var dropdownHeight=this.ext.height();var screenHeight=$("html").attr("clientHeight");var up=(o.top-$("html").attr("scrollTop")-$("body").attr("scrollTop"))-screenHeight+this.info("height")+dropdownHeight;up=up>0;if(up)
this.ext.css({top:o.top-dropdownHeight});else
this.ext.css({top:o.top+this.info("height")});var dropdownWidth=this.ext.width();var screenWidth=$("html").attr("clientWidth");var left=(o.left-$("html").attr("scrollLeft")-$("body").attr("scrollLeft"))-screenWidth+dropdownWidth;left+=20;if(left<0)left=0;this.ext.css({left:o.left-left});},cmd_handleFocused:function(){this.updateDropdownPosition();this.base();},cmd_destroy:function(){this.base();inx(this.private_item).cmd("destroy");}});