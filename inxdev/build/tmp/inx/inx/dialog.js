// @include inx.panel,inx.layout.fit,inx.dd

inx.dialog=inx.panel.extend({constructor:function(p){if(!p)p={};if(!p.layout)p.layout="inx.layout.fit";if(!p.x)p.x=$(window).width()/2-p.width/2;if(!p.y)p.y=$(window).height()/2-p.height/2+$(window).scrollTop();p.border=1;if(p.shadeOpacity===undefined)p.shadeOpacity=.7;this.base(p);this.cmd("focus");},cmd_destroy:function(){this.base();this.mate.remove();this.private_wnd&&this.private_wnd.remove();this.titleBar&&this.titleBar.cmd("destroy");},cmd_render:function(){if(this.mate)return;this.mate=$("<div style='width:100%;height:100%;background:black;position:fixed;left:0px;top:0px;' ></div>").css("opacity",0).appendTo("body");this.mate.animate({opacity:this.shadeOpacity})
this.mate.css("zIndex",inx.conf.z_index_dialog);this.private_wnd=$("<div>").addClass("inx-shadowframe").css({background:"#ededed",position:"absolute",zIndex:inx.conf.z_index_dialog,left:this.x,top:this.y}).appendTo("body");var c=$("<div>").css("margin","0px 0px 3px 0px").appendTo(this.private_wnd);this.titleBar=inx.cmp.create({type:"inx.dialog.title",height:20,width:this.width,title:this.title}).cmd("render",c);this.titleBar.on("drag",[this.id(),"drag"]);this.titleBar.setOwner(this);this.base(this.private_wnd);},cmd_drag:function(p){this.x+=p.dx;this.y+=p.dy;if(p.phase=="stop"){if(this.y<0)this.y=0;if(this.x<-this.info("width")+40)
this.x=-this.info("width")+40;}
this.private_wnd.css("left",this.x).css("top",this.y);}});inx.css(".inx-dialog-closeButton{float:right;cursor:pointer;width:20px;height:18px;background:url(%%inx.res%%/close.gif) center center no-repeat}",".inx-dialog-title{cursor:move;background:none;}",".inx-dialog-titleText{float:left;padding:3px 0px 0px 5px;font-weight:bold;color:#555555;}");inx.dialog.title=inx.box.extend({constructor:function(p){p.border=0;this.base(p);},cmd_render:function(c){this.base(c);this.el.addClass("inx-dialog-title");this.titleText=$("<div>").addClass("inx-dialog-titleText").html(this.title+"").appendTo(this.el);this.closeButton=$("<div>").addClass("inx-dialog-closeButton").appendTo(this.el).click(inx.dialog.title.close);inx.dd.enable(this.el,this,"drag");},cmd_drag:function(x,y){this.fire("drag",x,y);}})
inx.dialog.title.close=function(e){inx.cmp.fromElement(e.target).owner().cmd("destroy");}