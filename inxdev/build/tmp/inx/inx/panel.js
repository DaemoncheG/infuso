// @include inx.dd,inx.button

inx.css(".inx-panel-vs{background:url(%%inx.panel%%/vs.gif);position:absolute;cursor:e-resize;overflow:hidden;}",".inx-panel-hs{background:url(%%inx.panel%%/hs.gif);position:absolute;cursor:n-resize;overflow:hidden;}");inx.panel=inx.box.extend({constructor:function(p){if(!p.title)p.title="";if(!p.layout)p.layout="inx.layout['default']";if(p.padding)this.cmd("setPadding",p.padding);if(!p.side)p.side=[];if(p.tbar){this.tbar=inx.cmp.create({type:"inx.toolbar",items:p.tbar,region:"top"});p.side.unshift(this.tbar);}
if(p.bbar)p.side.unshift({type:"inx.toolbar",items:p.bbar,region:"bottom"});this.base(p);this.items=[];if(p.items)
for(var i in p.items)
this.cmd("add",p.items[i]);},__defaultChildType:"inx.panel",cmd_render:function(c){if(!this.info("rendered")){this.__layoutManager=eval(this.layout);if(c)this.container=c;this.base();this.__body=$("<div style='position:absolute;overflow:auto;' />").appendTo(this.el);this.cmd("autoHeight",this.autoHeight);var id=this.id();this.__body.scroll(inx.cmd(this,"handleBodyScroll"));this.__layoutManager.create.apply(this);var side=this.side||[];this.side=[];for(var i=0;i<side.length;i++)
this.cmd("addSidePanel",side[i]);for(var i=0;i<this.items.length;i++)
this.__layoutManager.add.apply(this,[this.items[i]]);this.__rendered=true;if(this.keepLayout)inx.storage.onready(this.id(),"restoreLayout");if(this.private_padding)
this.cmd("setPadding",this.private_padding);if(this.html)this.cmd("html",this.html);}},cmd_html:function(html){if(this.__body){if(typeof(html)=="object"){this.__body.html("");$(html).appendTo(this.__body)}else{this.__body.html("<div>"+html+"</div>");}
this.cmd("resizeToContents");var cmpid=this.id();var f=function(){inx(cmpid).cmd("resizeToContents");}
this.__body.find("img").load(f);}else this.html=html;},cmd_handleBodyScroll:function(e){this.private_scrollTop=this.__body.attr("scrollTop");},cmd_show:function(){this.base();this.cmd("restoreScroll");},cmd_restoreScroll:function(){if(this.info("hidden"))return;this.__body.attr("scrollTop",this.private_scrollTop);for(var i in this.items)
inx(this.items[i]).cmd("restoreScroll");},__appendTo:function(e){this.el.appendTo(e);},cmd_syncLayout:function(){this.base();if(!this.info("width"))return;this.private_updateSidePanels();this.__layoutManager.sync.apply(this);},info_layoutHash:function(){var ret=this.base("hash");if(this.__layoutManager.hash)
ret+=":"+this.__layoutManager.hash.apply(this);return ret;},cmd_restoreLayout:function(){if(!this.keepLayout)return;if(!this.private_layoutLoaded){this.private_loadedLayout=inx.storage.get(this.private_getLayoutKey())||{};this.private_layoutLoaded=1;}
for(var i in this.side)
if(this.private_loadedLayout[i]){var c=inx(this.side[i]);if(!c.info("resizable"))continue;var size=this.private_loadedLayout[i];(c.info("region")=="left"||c.info("region")=="right")?c.cmd("width",size):c.cmd("height",size);}},cmd_saveLayout:function(){if(!this.keepLayout)return;if(!this.private_layoutLoaded)return;var layout={};var flag=0;for(var i=0;i<this.side.length;i++){var r=inx(this.side[i]);if(!r.info("resizable"))continue;layout[r.info("name")||i]=(r.info("region")=="left"||r.info("region")=="right")?r.info("width"):r.info("height");flag=1;}
if(flag)inx.storage.set(this.private_getLayoutKey(),layout);},private_getLayoutKey:function(){if(this.keepLayout!==true&&this.keepLayout!==1)return this.keepLayout+":layout";return this.type+":layout";},cmd_addSidePanel:function(panel){panel=inx(panel,"inx.panel");panel.cmd("border",0);if(!this.side)this.side=[];this.side.push(panel.id());panel.setOwner(this.id());var e=$("<div />").css({position:"absolute"}).appendTo(this.el);panel.data("sidebarContainer",e);panel.cmd("render",e);var e=$("<div />").addClass((panel.info("region")=="left"||panel.info("region")=="right")?"inx-panel-vs":"inx-panel-hs").appendTo(this.el);panel.data("sidebarSeparator",e);if(panel.info("resizable"))
inx.dd.enable(e,this,"dragSeparator",panel);inx.storage.onready(this.id(),"restoreLayout");this.task("syncLayout");},cmd_removeSidePanel:function(cmp){var id=inx(cmp).id();for(var i in this.side)
if(this.side[i]==id){var side=inx(id);$(side.data("sidebarSeparator")).remove();$(side.data("sidebarContainer")).remove();this.side.splice(i,1);this.task("syncLayout");side.setOwner(0);break;}},cmd_dragSeparator:function(p,panel){switch(panel.info("region")){case"left":panel.cmd("width",panel.info("width")+p.dx);break;case"right":panel.cmd("width",panel.info("width")-p.dx);break;case"top":panel.cmd("height",panel.info("height")+p.dy);break;case"bottom":panel.cmd("height",panel.info("height")-p.dy);break;}
this.task("saveLayout");},private_updateSidePanels:function(){if(this.hidden)return;var l=0,r=0,t=0,b=0;var separatorHeight;for(var i=0;i<this.side.length;i++){var c=inx(this.side[i]);separatorHeight=c.info("resizable")?6:2;if(c.info("hidden")||c.info("param","hideSeparator"))separatorHeight=0;if(c.info("region")=="top"){c.info("container").css({top:t,left:0})
c.cmd("width",this.info("innerWidth"));t+=c.info("height");c.data("sidebarSeparator").css({left:0,top:t,height:separatorHeight,width:this.info("innerWidth")});t+=separatorHeight;}
if(c.info("region")=="bottom"){b+=c.info("height");c.info("container").css({top:this.info("innerHeight")-b,left:0})
c.cmd("width",this.info("innerWidth"));b+=separatorHeight;c.data("sidebarSeparator").css({left:0,top:this.info("innerHeight")-b,height:separatorHeight,width:this.info("innerWidth")});}}
var height=this.info("innerHeight")-t-b;if(height<0)height=0;var separatorWidth;for(var i=0;i<this.side.length;i++){var c=inx(this.side[i]);separatorWidth=c.info("resizable")?6:2;if(c.info("hidden")||c.info("param","hideSeparator"))separatorWidth=0;if(c.info("region")=="left"){c.info("container").css({top:t,left:l})
c.cmd("height",height);l+=c.info("width");c.data("sidebarSeparator").css({left:l,top:t,height:height,width:separatorWidth});l+=separatorWidth;}
if(c.info("region")=="right"){r+=c.info("width");c.info("container").css({top:t,left:this.info("innerWidth")-r})
c.cmd("height",height);r+=separatorWidth;c.data("sidebarSeparator").css({left:this.info("innerWidth")-r,top:t,height:height,width:separatorWidth});}}
var width=this.info("innerWidth")-l-r;if(width<0)width=0;var p=inx.geq(this.private_padding*2,0);this.__bodyWidth=width;this.__bodyHeight=height;this.__body.css({left:l,top:t,width:inx.geq(this.__bodyWidth-p,1),height:inx.geq(this.__bodyHeight-p,1)});},info_sideHeight:function(){var h=0;for(var i=0;i<this.side.length;i++){var c=inx(this.side[i]);var region=c.info("region");if(region=="top"||region=="bottom"){h+=c.info("resizable")?6:2;h+=c.info("height");}}
return h;},info_bodyHeight:function(){return this.info("height")-this.info("sideHeight");},info_bodyWidth:function(){return this.__bodyWidth||0;},cmd_setPadding:function(padding){padding*=1;if(this.__body){this.__body.css({padding:padding});this.task("syncLayout");}
this.private_padding=padding;},cmd_add:function(c){c=inx(c,this.__defaultChildType);c.setOwner(this.id());this.items.push(c.id());if(this.__body)
this.__layoutManager.add.apply(this,[c.id()]);},cmd_destroy:function(){this.base();for(var i in this.side)
inx(this.side[i]).cmd("destroy");},cmd_remove:function(cmp){id=inx(cmp).id();for(var i=0;i<this.items.length;i++)
if(this.items[i]==id){this.__layoutManager.remove.apply(this,[inx(id)]);this.items.splice(i,1);break;}
this.cmd("removeSidePanel",id);},cmd_destroyChildren:function(){if(this.items)
while(this.items.length)
inx(this.items[0]).cmd("destroy");},info_data:function(){var heap={};for(var i=0;i<this.items.length;i++){var cmp=inx(this.items[i]);var name=cmp.info("name");if(name)heap[name]=cmp.info("value");var data=cmp.info("data");if(data){for(var j in data)
heap[j]=data[j];}}
return heap;}});inx.ns("inx.layout")["default"]={create:function(){},add:function(id){if(this.padding===undefined)this.cmd("setPadding",5);if(!this.pivate_pdc)
this.pivate_pdc=$("<div>").css({padding:"0px 0px 5px 0px"}).appendTo(this.__body);var e=$("<div>").css({margin:"0px 0px 5px 0px"}).appendTo(this.pivate_pdc);inx(id).cmd("render",e);inx(id).data("layoutContainer",e)},remove:function(cmp){var e=cmp.data("layoutContainer").get(0);e.parentNode.removeChild(e);},sync:function(){}}
inx.panel.separator=inx.box.extend({constructor:function(p){if(!p)p={};p.height=22;p.border=0;this.base(p);},cmd_render:function(c){this.base(c);$("<div/>").css({borderLeft:"1px solid gray",borderRight:"1px solid white",height:"100%"}).appendTo(this.el);}});inx.css(".inx-toolbar{background:url(%%inx.res%%/bg.gif) center center;font-size:1px;}",".inx-toolbar-item{margin:0px;vertical-align:middle;padding:4px;}");inx.panel.toolbar=inx.panel.extend({__defaultChildType:"inx.toolbar_button",layout:"inx.toolbar.layout",cmd_render:function(container){this.base(container);this.__body.addClass("inx-toolbar");this.cmd("height",30);},cmd_add:function(c){if(c=="|")c={type:"inx.panel.separator"};this.base(c);}});inx.toolbar=inx.panel.toolbar;inx.toolbar.layout={add:function(cmp){cmp=inx(cmp);var c=$("<div class='inx-core-inlineBlock inx-toolbar-item' />").appendTo(this.__body);cmp.cmd("render",c);cmp.data("layoutContainer",c);},create:function(){this.__body.css("overflow","hidden")},sync:function(){},remove:function(cmp){var e=cmp.data("layoutContainer").get(0);e.parentNode.removeChild(e);}}
inx.toolbar_button=inx.button.extend({constructor:function(p){p.air=1;this.base(p);}});